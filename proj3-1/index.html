<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <style>
    body {
      padding: 100px;
      width: 1000px;
      margin: auto;
      text-align: left;
      font-weight: 300;
      font-family: 'Open Sans', sans-serif;
      color: #121212;
    }

    h1,
    h2,
    h3,
    h4 {
      font-family: 'Source Sans Pro', sans-serif;
    }
  </style>
  <title>CS 184 Path Tracer</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Sans+Pro" rel="stylesheet">
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>


<body>

	<h1 align="middle">CS 284: Computer Graphics and Imaging, Spring 2022</h1>
	<h1 align="middle">Project 3: Path Tracer</h1>
	<h2 align="middle">Xiao Song (xiaosx@berkeley.edu), Haohua Lyu (haohua@berkeley.edu)</h2>

	<br><br>

	<div>

	<h2 align="middle">Part 1: Ray Generation and Scene Intersection</h2>

	<h3>Ray generation and intersection pipeline</h3>
	<ol>
		<li>In the <code>raytrace_pixel()</code> function, we take num_samples of random sample ray for a given pixel location <code>(x, y)</code>. The random sample is generated by creating ray that originates from <code>(0,0)</code> and ends in <code>( x: x+1, y: y+1 )</code>. </li>
		<li>For each random ray, we call <code>est_radiance_global_illumination()</code> to estimate the global illumination of that sample ray. </li>
		<li>In <code>est_radiance_global_illumination()</code>, we first check if the ray intersect with any object in the given scene ( by calling <code>bvh->intersect(r, &isect)</code> ). </li>
		<li>If the ray intersects with any object, we compute the zero bounce light ( the hit point is a light source and has its own emission ) and at least one bounce light at the hit location.</li>
		<li>After estimating all illumination of all sample ray, we compute their average and use its average value ( an MC estimation ) as that pixels illumination. </li>
	</ol>

	<h3>Explain triangle intersection algorithm</h3>
	<p>There are two ways to implement ray triangle intersection. First is to intersect the ray with a plane and then check if the hit point is inside the triangle or not. Second is to use the Möller Trumbore algorithm. In this homework, we choose to implement the Möller Trumbore algorithm. </p>
	<p>The basic idea of the Möller Trumbore algorithm is to convert the “point inside triangle” test into an “implicit surface”, and then solve the ray triangle test like other ray implicit surface tests. Specifically, </p>
	<ol>
		<li>the “point inside triangle” test is converted into <code>(1 - b1 - b2 ) p0 + b1 * p1 + b2 * p2</code>, where the triangle is represented in their barycentric coordinates. </li>
		<li>The ray is represented with <code>O + t D.</code></li>
		<li>After solving the equation and getting a solution for t, b1, b2. We then check if <code>b1, b2, (1-b1-b2)</code> is within the range of <code>[0, 1)</code>. This is the same as checking if a point is inside the triangle or not with barycentric coordinates.</li>
	</ol>

	<h3>Normal shading result</h3>
	<div align="middle">
		<table style="width=100%">
		  <tr>
			<td>
			  <img src="part1_visual/CBempty.png" align="middle" width="500px"/>
			  <figcaption align="middle">CBempty.dae</figcaption>
			</td>
			<td>
			  <img src="part1_visual/CBlucy.png" align="middle" width="500px"/>
			  <figcaption align="middle">CBlucy.dae</figcaption>
			</td>
		  </tr>
		  <tr>
			<td>
			  <img src="part1_visual/CBspheres.png" align="middle" width="500px"/>
			  <figcaption align="middle">CBspheres.dae</figcaption>
			</td>
		  </tr>
		</table>
	</div>

	<h2 align="middle">Part 2: Bounding Volume Hierarchy</h2>

	<h2 align="middle">Part 3: Direct Illumination</h2>
	<h3>Implementation of direct light sample over hemisphere</h3>
	<ol>
		<li>Given an input ray <code>w_out</code> and its intersection hit point <code>hit_p</code> in the scene. We random sample <code>number of light * number of samples per light</code> random input ray <code>w_in</code>. The random w_in is uniformly sampled over a unit hemisphere over the hit point.</li>
		<li>For each random sample <code>w_in</code> ray, we cast a ray into the scene ( where the starting of ray is the hit point, and the direction of the ray is <code>w_in</code> ) and check if the ray intersects with any object inside the scene.</li>
		<li>If the ray intersect with object inside the scene (hit_light), we compute this MC sample as <code>f( hit_p, w_in, w_out ) * L_i( hit_light, w_in ) * cos (theta) / p( w_in )</code>, where <code>f( hit_p, w_in, w_out )</code> is the brdf term of hit_p, <code>L_i( hit_light, w_in ) </code>is the intersected objects emitted light. If the intersected object hit_light is not a light source, its <code>L_i( hit_p, w_in )</code> would be zero and not contribute to MC estimation.</li>
		<li>We average the result over the number of samples we take.</li>
	</ol>

	<h3>Implementation of direct light sample over light source</h3>
	<ol>
		<li>Given an input ray <code>w_out</code> and its intersection hit point <code>hit_p</code> in the scene.</li>
		<li>We iterate through all the light sources in the scene. If the light source is a point light, we generate one ray between the light source and the hit point <code>hit_p</code>. If the light source is not a point light, we uniformly sample ns_area_light locations on the light source and create rays between the light source random point and hit point <code>hit_p</code>.</li>
		<li>For every ray created in step (2), we check if the ray intersects any object between hit_p and the light source. This is the “shadow ray” idea mentioned in the spec. </li>
		<li>If there is no object in between, then this MC sample as <code>f( hit_p, w_in, w_out ) * L_i( light, w_in ) * cos (theta) / p( w_in )</code>. </li>
	</ol>
	<p>Different from the hemisphere case, we uniformly sample over the light source and use bvh to check if there is no object between the light and hit_p</p>
	
	<h3>Image sample result on both direct lightning method</h3>

	<p>TODO: RESULT MIGHT BE INCORRECT, DOUBLE CHECK</p>

	<div align="middle">
		<table style="width=100%">
		  <tr>
			<td>
			  <img src="part3_visual/h_CBbunny.png" align="middle" width="500px"/>
			  <figcaption align="middle">Hemisphere sample CBbunny.dae</figcaption>
			</td>
			<td>
				<img src="part3_visual/l_CBbunny.png" align="middle" width="500px"/>
				<figcaption align="middle">Light sample CBbunny.dae</figcaption>
			</td>
		  </tr>

		  <tr>
			<td>
			  <img src="part3_visual/h_CBempty.png" align="middle" width="500px"/>
			  <figcaption align="middle">Hemisphere sample CBempty.dae</figcaption>
			</td>
			<td>
				<img src="part3_visual/l_CBempty.png" align="middle" width="500px"/>
				<figcaption align="middle">Light sample CBempty.dae</figcaption>
			</td>
		  </tr>

		  <tr>
			<td>
			  <img src="part3_visual/h_CBspheres.png" align="middle" width="500px"/>
			  <figcaption align="middle">Hemisphere sample CBspheres.dae</figcaption>
			</td>
			<td>
				<img src="part3_visual/l_CBspheres.png" align="middle" width="500px"/>
				<figcaption align="middle">Light sample CBspheres.dae</figcaption>
			</td>
		  </tr>

		  <tr>
			<td>
			  <img src="part3_visual/h_dragon.png" align="middle" width="500px"/>
			  <figcaption align="middle">Hemisphere sample dragon.dae</figcaption>
			</td>
			<td>
				<img src="part3_visual/l_dragon.png" align="middle" width="500px"/>
				<figcaption align="middle">Light sample dragon.dae</figcaption>
			</td>
		  </tr>
		</table>
	</div>


	<h2 align="middle">Part 4: Global Illumination</h2>

	<h2 align="middle">Part 5: Adaptive Sampling</h2>


    <p>txt<code>curve3.bzc</code>text</p>
	<ol>
		<li>list1</li>
		<li>list2</li>
		<li>list3</li>
	</ol>
		
	<div align="middle">
		<table style="width=100%">
		  <tr>
			<td>
			  <img src="images/p1_raw.png" align="middle" width="500px"/>
			  <figcaption align="middle">The new <code>bzc/curve3.bzc</code> created, with 6 control points shown.</figcaption>
			</td>
			<td>
			  <img src="images/p1_curve.png" align="middle" width="500px"/>
			  <figcaption align="middle">The new <code>bzc/curve3.bzc</code> created, with the curve shown.</figcaption>
			</td>
		  </tr>
		</table>
	</div>
	
	<h3 align="middle">Appendix</h3>

	<a href="https://cal-cs184-student.github.io/sp22-project-webpages-Haohua-Lyu-and-Xiao-Song/">Link to project webpage</a>

</body>

</html>